<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ üí∞ (Full iPad Version)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&family=Prompt:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #FFF8F0;
            --primary-color: #E8734A;
            --secondary-color: #F4A261;
            --text-color: #3D2C2E;
        }
        body { font-family: 'Sarabun', 'Prompt', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px 16px; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: white; border-radius: 16px; box-shadow: 0 2px 16px rgba(0,0,0,0.05); padding: 24px; margin-bottom: 20px; }
        .section-title { font-size: 18px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .input-field { width: 100%; padding: 12px; border: 2px solid #E8D5C4; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .btn-primary { background: var(--primary-color); color: white; border: none; border-radius: 12px; padding: 12px 24px; font-weight: bold; cursor: pointer; width: 100%; }
        .table-container { overflow-x: auto; border-radius: 12px; border: 2px solid #F0DFD0; }
        table { width: 100%; border-collapse: collapse; min-width: 850px; font-size: 14px; }
        th { background: #F8F1EA; padding: 14px; text-align: left; }
        td { padding: 12px 14px; border-bottom: 1px solid #F0E6DC; background: white; }
        .tab-btn { padding: 8px 16px; border: 2px solid #E8D5C4; background: white; border-radius: 10px; cursor: pointer; margin-right: 5px; white-space: nowrap; }
        .tab-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .bulk-bar { display: none; background: #FFF0E0; border: 2px solid var(--primary-color); border-radius: 12px; padding: 12px 14px; margin-bottom: 14px; justify-content: space-between; align-items: center; }
        .txt-‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö { color: #1B8C5A; font-weight: bold; }
        .txt-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ { color: #E74C3C; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; margin-bottom:20px;">
        <h1>üìí ‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>
    </header>

    <div class="card">
        <div class="section-title">üè¶ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="text" id="newAcc" class="input-field" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà">
            <button onclick="addAccount()" class="btn-primary" style="width:auto;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
        <div id="accBadges" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
    </div>

    <div class="card">
        <div class="section-title">üìù ‡∏•‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
            <div><label>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="date" class="input-field"></div>
            <div><label>üè¶ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><select id="accSelect" class="input-field"></select></div>
            <div><label>üìä ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select id="type" class="input-field"><option value="‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢" selected>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option></select></div>
            <div><label>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label><input type="text" id="desc" class="input-field" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"></div>
            <div><label>üíµ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label><input type="number" id="amt" class="input-field" placeholder="0.00"></div>
        </div>
        <button class="btn-primary" onclick="saveData()" style="margin-top:20px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ üí∞</button>
    </div>

    <div class="card">
        <div style="background: #FFF5EC; border: 2px dashed #F4A261; padding: 16px; border-radius: 14px; margin-bottom: 20px;">
            <label style="font-weight:bold;">üìÇ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel:</label>
            <input type="file" accept=".xlsx" onchange="handleExcelImport(this)" style="margin-top:10px; width:100%;">
        </div>

        <div id="bulkDeleteBar" class="bulk-bar">
            <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <span id="selectedCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            <button onclick="bulkDelete()" style="background:#E74C3C; color:white; border:none; border-radius:10px; padding:8px 16px;">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
        </div>

        <div id="bankTabs" style="display:flex; gap:5px; margin-bottom:15px; overflow-x:auto;"></div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width:40px;"><input type="checkbox" onchange="toggleAll(this)"></th>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="dataTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let accounts = JSON.parse(localStorage.getItem('FIN_V6_ACCS')) || ['‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ ‡∏ö‡∏µ', '‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô'];
    let logs = JSON.parse(localStorage.getItem('FIN_V6_LOGS')) || [];
    let currentTab = '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
    let editingId = null;
    let selectedIds = new Set();

    document.getElementById('date').valueAsDate = new Date();

    function addAccount() {
        let name = document.getElementById('newAcc').value.trim();
        if(name && !accounts.includes(name)) { accounts.push(name); saveAndUI(); document.getElementById('newAcc').value = ''; }
    }

    function removeAccount(name) { if(confirm(`‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ${name}?`)) { accounts = accounts.filter(a => a !== name); saveAndUI(); } }

    function saveData() {
        let amt = parseFloat(document.getElementById('amt').value) || 0;
        if(amt <= 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô");
        logs.push({ id: Date.now(), date: document.getElementById('date').value, acc: document.getElementById('accSelect').value, type: document.getElementById('type').value, desc: document.getElementById('desc').value || "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", amt: amt });
        document.getElementById('amt').value = '';
        saveAndUI();
    }

    function handleExcelImport(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            let temp = [];
            workbook.SheetNames.forEach(name => {
                const sheetData = XLSX.utils.sheet_to_json(workbook.Sheets[name], {range: 5});
                sheetData.forEach(row => { if(row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]) temp.push({ id: Date.now()+Math.random(), date: row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"], acc: name, type: row["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"], desc: row["‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"], amt: parseFloat(row["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"])||0 }); });
            });
            if(temp.length > 0 && confirm(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ${temp.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?`)) { logs = [...logs, ...temp]; saveAndUI(); }
            input.value = "";
        };
        reader.readAsArrayBuffer(file);
    }

    function startEdit(id) { editingId = id; updateUI(); }
    function saveEdit(id) {
        const item = logs.find(l => l.id === id);
        if (item) {
            item.date = document.getElementById(`ed-date-${id}`).value;
            item.acc = document.getElementById(`ed-acc-${id}`).value;
            item.type = document.getElementById(`ed-type-${id}`).value;
            item.desc = document.getElementById(`ed-desc-${id}`).value;
            item.amt = parseFloat(document.getElementById(`ed-amt-${id}`).value) || 0;
            editingId = null; saveAndUI();
        }
    }

    function updateUI() {
        document.getElementById('accSelect').innerHTML = accounts.map(a => `<option value="${a}">${a}</option>`).join('');
        document.getElementById('accBadges').innerHTML = accounts.map(a => `<span style="background:#F0E6DC; padding:6px 12px; border-radius:20px; font-size:13px; margin-right:5px;">${a} <b onclick="removeAccount('${a}')" style="color:red; cursor:pointer;">√ó</b></span>`).join('');
        
        let tabHtml = `<button class="tab-btn ${currentTab==='‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'?'active':''}" onclick="setTab('‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`;
        accounts.forEach(a => tabHtml += `<button class="tab-btn ${currentTab===a?'active':''}" onclick="setTab('${a}')">${a}</button>`);
        document.getElementById('bankTabs').innerHTML = tabHtml;

        logs.sort((a,b) => new Date(a.date) - new Date(b.date));
        let bals = {}; accounts.forEach(a => bals[a] = 0);
        let processed = logs.map(l => {
            l.type === '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' ? bals[l.acc] += l.amt : bals[l.acc] -= l.amt;
            return { ...l, runningBal: bals[l.acc] };
        });

        let filtered = processed;
        if(currentTab !== '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') filtered = processed.filter(l => l.acc === currentTab);

        document.getElementById('dataTable').innerHTML = [...filtered].reverse().map(l => {
            if (editingId === l.id) {
                let accOpts = accounts.map(a => `<option value="${a}" ${a===l.acc?'selected':''}>${a}</option>`).join('');
                return `<tr><td></td><td><input type="date" id="ed-date-${l.id}" value="${l.date}" class="input-field"></td><td><select id="ed-acc-${l.id}" class="input-field">${accOpts}</select></td><td><select id="ed-type-${l.id}" class="input-field"><option value="‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö" ${l.type==='‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö'?'selected':''}>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢" ${l.type==='‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'?'selected':''}>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option></select></td><td><input type="text" id="ed-desc-${l.id}" value="${l.desc}" class="input-field"></td><td><input type="number" id="ed-amt-${l.id}" value="${l.amt}" class="input-field"></td><td>-</td><td><button onclick="saveEdit(${l.id})">‚úîÔ∏è</button></td></tr>`;
            }
            return `<tr style="${selectedIds.has(l.id)?'background:#FFF0E0':''}"><td><input type="checkbox" onchange="toggleItem(${l.id})" ${selectedIds.has(l.id)?'checked':''}></td><td>${l.date}</td><td><small>${l.acc}</small></td><td class="txt-${l.type}">${l.type}</td><td>${l.desc}</td><td class="txt-${l.type}">${l.amt.toLocaleString()}</td><td style="font-weight:bold">${l.runningBal.toLocaleString()}</td><td><button onclick="startEdit(${l.id})">‚úèÔ∏è</button><button onclick="deleteEntry(${l.id})">üóëÔ∏è</button></td></tr>`;
        }).join('');
        
        document.getElementById('bulkDeleteBar').style.display = selectedIds.size > 0 ? 'flex' : 'none';
        document.getElementById('selectedCount').textContent = selectedIds.size;
    }

    function toggleItem(id) { if(selectedIds.has(id)) selectedIds.delete(id); else selectedIds.add(id); updateUI(); }
    function toggleAll(el) { if(el.checked) logs.forEach(l => selectedIds.add(l.id)); else selectedIds.clear(); updateUI(); }
    function bulkDelete() { if(confirm(`‡∏•‡∏ö ${selectedIds.size} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?`)) { logs = logs.filter(l => !selectedIds.has(l.id)); selectedIds.clear(); saveAndUI(); } }
    function deleteEntry(id) { if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { logs = logs.filter(l => l.id !== id); saveAndUI(); } }
    function setTab(name) { currentTab = name; updateUI(); }
    function saveAndUI() { localStorage.setItem('FIN_V6_ACCS', JSON.stringify(accounts)); localStorage.setItem('FIN_V6_LOGS', JSON.stringify(logs)); updateUI(); }
    updateUI();
</script>
</body>
</html>
